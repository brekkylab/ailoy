name: Build - Node.js All Platforms

on:
  workflow_call:
    inputs:
      publish:
        type: boolean
        required: false
        description: 'Publish package to NPM'
  workflow_dispatch:
    inputs:
      publish:
        type: boolean
        required: false
        description: 'Publish package to NPM'

permissions:
  id-token: write
  contents: read
  packages: read

env:
  NODE_VERSION: "20.19.4"

jobs:
  # Build platform-specific packages
  build-linux:
    uses: ./.github/workflows/build_nodejs_linux.yaml
    with:
      publish: ${{ inputs.publish }}
    secrets: inherit

  build-macos:
    uses: ./.github/workflows/build_nodejs_macos.yaml
    with:
      publish: ${{ inputs.publish }}
    secrets: inherit

  build-windows:
    uses: ./.github/workflows/build_nodejs_windows.yaml
    with:
      publish: ${{ inputs.publish }}
    secrets: inherit

  # Build main package
  build-main:
    needs: [build-linux, build-macos, build-windows]
    uses: ./.github/workflows/build_nodejs_main.yaml
    with:
      publish: ${{ inputs.publish }}
    secrets: inherit
