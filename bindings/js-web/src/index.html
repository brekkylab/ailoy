<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ailoy WASM Test</title>
</head>
<body>
    <h1>Ailoy WASM Test</h1>

    <script type="module">
        import * as Ailoy from "./index.js"

        window.Vips = Ailoy.Vips;

        const rt = new Ailoy.Runtime();
        await rt.start();
        window.runtime = rt;

        const agent = await Ailoy.defineAgent(rt, Ailoy.APIModel({id: "gpt-4o", apiKey: "<OPENAI_API_KEY>"}));
        await agent.addToolsFromMcpClient("test", new Ailoy.MCPStreamableHTTPClientTransport("http://localhost:8123/mcp"));
        window.agent = agent;

        console.log(agent.getTools());

        // await rt.define("chat_manager", "cm0", {model: "Qwen/Qwen3-0.6B"});
        // await rt.define("tokenizer", "t0", {model: "Qwen/Qwen3-0.6B"});

        // let templated = await rt.callMethod("cm0", "apply_chat_template", {
        //     messages: [
        //         {role: "system", content: [{type: "text", text: "You are awesome model."}]},
        //         {role: "user", content: [{type: "text", text: "What is your name?"}]},
        //     ],
        //     tools: [],
        //     reasoning: true,
        //     add_generation_prompt: true,
        // });
        // console.log(templated.result);

        // let encoded = await rt.callMethod("t0", "encode", {text: templated.result});
        // console.log(encoded.tokens);

        // let decoded = await rt.callMethod("t0", "decode", {tokens: encoded.tokens});
        // console.log(decoded.text);

    </script>
    
</body>
</html>
