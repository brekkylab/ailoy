"use strict";(self.webpackChunkailoy_docs=self.webpackChunkailoy_docs||[]).push([[1803],{74:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/image-input-a21235bc15cafb9a39de96bea9b80e8a.gif"},129:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/mcp-tool-86cdb3120e3c5a76cc2798003cfa424a.gif"},1328:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/chat-ui-910c4fa27e3cc73b3429e908408ff6cc.png"},1575:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/simple-tool-0d9f40bb39fd115acd1bc3d89dbe9844.gif"},6615:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/simple-chat-4df27ebff4bcaee797a47b03fbd6ccec.gif"},8306:(e,n,s)=>{s.d(n,{A:()=>t});const t=s.p+"assets/images/reasoning-c32ebf0f22d1623776f6701c52fd2c6b.gif"},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>a});var t=s(6540);const r={},i=t.createContext(r);function o(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},9573:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tutorial/webassembly-supports","title":"WebAssembly Supports","description":"WebAssembly support is currently experimental, and you may encounter","source":"@site/docs/tutorial/webassembly-supports.mdx","sourceDirName":"tutorial","slug":"/tutorial/webassembly-supports","permalink":"/ailoy/docs/tutorial/webassembly-supports","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentSidebar","previous":{"title":"Managing Model Files","permalink":"/ailoy/docs/tutorial/managing-model-files"},"next":{"title":"How Agent Works","permalink":"/ailoy/docs/concepts/how-agent-works"}}');var r=s(4848),i=s(8453);const o={},a="WebAssembly Supports",l={},c=[{value:"Hardware Requirements",id:"hardware-requirements",level:2},{value:"Building a Simple Chat UI",id:"building-a-simple-chat-ui",level:2},{value:"Setup Vite and install <code>ailoy-web</code>",id:"setup-vite-and-install-ailoy-web",level:3},{value:"Install and configure <code>assistant-ui</code>",id:"install-and-configure-assistant-ui",level:3},{value:"Implementation",id:"implementation",level:3},{value:"Additional Features",id:"additional-features",level:2},{value:"Using API models",id:"using-api-models",level:3},{value:"Multi-Modal Inputs",id:"multi-modal-inputs",level:3},{value:"Reasoning",id:"reasoning",level:3},{value:"Using Tools",id:"using-tools",level:3},{value:"Using MCP Tools",id:"using-mcp-tools",level:3},{value:"Using Vector Stores",id:"using-vector-stores",level:2},{value:"Creating an EmbeddingModel",id:"creating-an-embeddingmodel",level:3},{value:"Creating a VectorStore",id:"creating-a-vectorstore",level:3},{value:"Inserting Documents",id:"inserting-documents",level:3},{value:"Retrieving Documents",id:"retrieving-documents",level:3},{value:"Clearing the Vector Store",id:"clearing-the-vector-store",level:3}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components},{TerminalBox:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("TerminalBox",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"webassembly-supports",children:"WebAssembly Supports"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["WebAssembly support is currently ",(0,r.jsx)(n.strong,{children:"experimental"}),", and you may encounter\nunexpected errors. If you do, please report them via our\n",(0,r.jsx)(n.a,{href:"https://github.com/brekkylab/ailoy/issues",children:(0,r.jsx)(n.strong,{children:"GitHub Issues"})})," or\n",(0,r.jsx)(n.a,{href:"https://discord.gg/27rx3EJy3P",children:(0,r.jsx)(n.strong,{children:"Discord"})})," channel so we can address them\npromptly."]})}),"\n",(0,r.jsxs)(n.p,{children:["Ailoy supports running agents entirely in modern web browsers using\n",(0,r.jsx)(n.strong,{children:"WebAssembly (WASM)"}),". This enables AI workloads directly in the browser with\nno backend required."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key capabilities"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Run local models accelerated by ",(0,r.jsx)(n.strong,{children:"WebGPU"}),"\u2014supports both ",(0,r.jsx)(n.strong,{children:"LangModel"}),"s and\n",(0,r.jsx)(n.strong,{children:"EmbeddingModel"}),"s."]}),"\n",(0,r.jsx)(n.li,{children:"Use API models just like you would in native environments."}),"\n",(0,r.jsxs)(n.li,{children:["Register your own ",(0,r.jsx)(n.strong,{children:"custom tools"})," or ",(0,r.jsx)(n.strong,{children:"MCP tools"})," (via Streamable HTTP\ntransport) on agents."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.strong,{children:"vector stores"})," to construct a RAG pipeline."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["This guide walks you through setting up and using ",(0,r.jsx)(n.code,{children:"ailoy-web"})," in your\nbrowser-based applications."]}),"\n",(0,r.jsx)(n.h2,{id:"hardware-requirements",children:"Hardware Requirements"}),"\n",(0,r.jsxs)(n.p,{children:["If you plan to run local models with WebGPU, make sure your system has the\nnecessary hardware accelerators and drivers installed. See\n",(0,r.jsx)(n.a,{href:"/ailoy/docs/resources/supported-environments",children:(0,r.jsx)(n.strong,{children:"Supported Environments"})})," for more\ndetails."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"MacOS with Apple Silicon"}),": Fully supported, typically works out of the box."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Windows / Linux with NVIDIA or AMD GPUs"}),": Ensure that the latest GPU\ndrivers are installed."]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["In addition, WebGPU must support certain features\u2014such as ",(0,r.jsx)(n.code,{children:"shader-f16"}),". You can\nquickly verify your setup using the ",(0,r.jsx)(n.code,{children:"isWebGPUSupported"})," utility:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:'import { isWebGPUSupported } from "ailoy-web";\n\nconst { supported, reason } = await isWebGPUSupported();\nif (supported) {\n  // WebGPU is supported\n  console.log("\u2705 WebGPU is available!");\n} else {\n  // WebGPU is not supported\n  console.log(\n    "\u274c WebGPU is not available due to the following reason: ",\n    reason\n  );\n}\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["If WebGPU is not supported, consider showing users a clear message in your UI\nthat explains why\u2014using the ",(0,r.jsx)(n.code,{children:"reason"})," value returned by the function."]})}),"\n",(0,r.jsx)(n.h2,{id:"building-a-simple-chat-ui",children:"Building a Simple Chat UI"}),"\n",(0,r.jsxs)(n.p,{children:["In this tutorial, we're going to build a simple chat UI application using Ailoy.\nYou can see the full example codes in\n",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://github.com/brekkylab/ailoy/tree/main/examples/web-assistant-ui",children:"our repository"})}),"."]}),"\n",(0,r.jsxs)(n.h3,{id:"setup-vite-and-install-ailoy-web",children:["Setup Vite and install ",(0,r.jsx)(n.code,{children:"ailoy-web"})]}),"\n",(0,r.jsxs)(n.p,{children:["We recommend using ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://vite.dev/",children:"Vite"})})," for a fast development\nenvironment and optimized builds. Still you can use another build tools you\nprefer, such as Webpack, Rollup, or Parcel."]}),"\n",(0,r.jsxs)(n.p,{children:["In this example, we use Vite to create a project with ",(0,r.jsx)(n.strong,{children:"React + TypeScript"}),"\nconfiguration."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Let's create a Vite project by running ",(0,r.jsx)(n.code,{children:"npm create vite@latest"}),"."]}),"\n"]}),"\n","\n",(0,r.jsxs)(t,{children:[(0,r.jsx)(n.p,{children:"$ npm create vite@latest"}),(0,r.jsx)(n.p,{children:"> npx\n> create-vite"}),(0,r.jsx)(n.p,{children:"\u2502\n\u25c7  Project name:\n\u2502  my-project\n\u2502\n\u25c7  Select a framework:\n\u2502  React\n\u2502\n\u25c7  Select a variant:\n\u2502  TypeScript\n\u2502\n\u25c7  Scaffolding project in /path/of/my-project...\n\u2502\n\u2514  Done. Now run:"}),(0,r.jsx)(n.p,{children:"cd my-project\nnpm install\nnpm run dev"})]}),"\n","\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Next, navigate to your new project and install ",(0,r.jsx)(n.code,{children:"ailoy-web"}),". This will also\ninstall packages preconfigured in ",(0,r.jsx)(n.code,{children:"package.json"}),"."]}),"\n"]}),"\n","\n",(0,r.jsxs)(t,{children:[(0,r.jsx)(n.p,{children:"$ cd my-project\n$ npm install ailoy-web"}),(0,r.jsx)(n.p,{children:"added 265 packages, and audited 266 packages in 4s"}),(0,r.jsxs)(n.p,{children:["64 packages are looking for funding\nrun ",(0,r.jsx)(n.code,{children:"npm fund"})," for details"]}),(0,r.jsx)(n.p,{children:"found 0 vulnerabilities"})]}),"\n","\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["To ensure optimal performance and compatibility, update your ",(0,r.jsx)(n.code,{children:"vite.config.ts"}),"\nwith the following settings:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Exclude ",(0,r.jsx)(n.code,{children:"ailoy-web"})," from dependency optimization (",(0,r.jsx)(n.code,{children:"optimizeDeps.exclude"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:["Enable cross-origin isolation (required for ",(0,r.jsx)(n.code,{children:"SharedArrayBuffer"})," in WASM\nthreading)"]}),"\n",(0,r.jsxs)(n.li,{children:["Optimize bundle size by grouping ",(0,r.jsx)(n.code,{children:"ailoy-web"})," into its own build chunk"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import react from "@vitejs/plugin-react";\nimport { defineConfig } from "vite";\n\nexport default defineConfig({\n  plugins: [react()],\n  optimizeDeps: {\n    exclude: ["ailoy-web"],\n  },\n  server: {\n    headers: {\n      "Cross-Origin-Embedder-Policy": "require-corp",\n      "Cross-Origin-Opener-Policy": "same-origin",\n    },\n  },\n  build: {\n    rollupOptions: {\n      output: {\n        manualChunks: {\n          ailoy: ["ailoy-web"],\n        },\n      },\n    },\n  },\n});\n'})}),"\n",(0,r.jsxs)(n.h3,{id:"install-and-configure-assistant-ui",children:["Install and configure ",(0,r.jsx)(n.code,{children:"assistant-ui"})]}),"\n",(0,r.jsxs)(n.p,{children:["For this quick demo, we'll use ",(0,r.jsx)(n.a,{href:"https://www.assistant-ui.com/",children:(0,r.jsx)(n.strong,{children:"assistant-ui"})}),"\npackage to create a basic chat interface."]}),"\n",(0,r.jsxs)(n.p,{children:["It relies on ",(0,r.jsx)(n.a,{href:"https://ui.shadcn.com/docs/installation/vite",children:(0,r.jsx)(n.strong,{children:"shadcn"})}),", so\nwe'll set that up first. Follow the guide from\n",(0,r.jsx)(n.a,{href:"https://ui.shadcn.com/docs/installation/vite",children:(0,r.jsx)(n.strong,{children:"shadcn's documentation"})}),"."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Edit ",(0,r.jsx)(n.code,{children:"tsconfig.json"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:"{11-16}",children:'{\n  "files": [],\n  "references": [\n    {\n      "path": "./tsconfig.app.json"\n    },\n    {\n      "path": "./tsconfig.node.json"\n    }\n  ],\n  "compilerOptions": {\n    "baseUrl": ".",\n    "paths": {\n      "@/*": ["./src/*"]\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Edit ",(0,r.jsx)(n.code,{children:"tsconfig.app.json"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:"{4-7}",children:'{\n  "compilerOptions": {\n    // ...\n    "baseUrl": ".",\n    "paths": {\n      "@/*": ["./src/*"]\n    }\n    // ...\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Install ",(0,r.jsx)(n.code,{children:"tailwind"})," and update ",(0,r.jsx)(n.code,{children:"vite.config.ts"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(t,{children:[(0,r.jsx)(n.p,{children:"$ npm install --save-dev tailwindcss @tailwindcss/vite @types/node"}),(0,r.jsx)(n.p,{children:"added 22 packages, and audited 215 packages in 3s"}),(0,r.jsxs)(n.p,{children:["51 packages are looking for funding run ",(0,r.jsx)(n.code,{children:"npm fund"})," for details"]}),(0,r.jsx)(n.p,{children:"found 0 vulnerabilities"})]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{1-2,8-13}",children:'import path from "node:path";\nimport tailwindcss from "@tailwindcss/vite";\nimport react from "@vitejs/plugin-react";\nimport { defineConfig } from "vite";\n\n// https://vite.dev/config/\nexport default defineConfig({\n  plugins: [react(), tailwindcss()],\n  resolve: {\n    alias: {\n      "@": path.resolve(__dirname, "./src"),\n    },\n  },\n  // other configs\n});\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"src/index.css"})," to use tailwindcss."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-css",children:'@import "tailwindcss";\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:["Install ",(0,r.jsx)(n.code,{children:"assistant-ui"})," and add thread component.",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"npx assistant-ui add thread"})]}),"\n"]}),"\n","\n",(0,r.jsxs)(t,{children:[(0,r.jsx)(n.p,{children:"$ npx assistant-ui add thread\n\u2714 You need to create a components.json file to add components. Proceed? \u2026 yes\n\u2714 Which color would you like to use as the base color? \u203a Neutral\n\u2714 Writing components.json.\n\u2714 Checking registry.\n\u2714 Installing dependencies.\n\u2714 Created 6 files:"}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"src/components/assistant-ui/thread.tsx"}),"\n",(0,r.jsx)(n.li,{children:"src/components/assistant-ui/markdown-text.tsx"}),"\n",(0,r.jsx)(n.li,{children:"src/components/assistant-ui/tooltip-icon-button.tsx"}),"\n",(0,r.jsx)(n.li,{children:"src/components/assistant-ui/tool-fallback.tsx"}),"\n",(0,r.jsx)(n.li,{children:"src/components/ui/button.tsx"}),"\n",(0,r.jsx)(n.li,{children:"src/components/ui/tooltip.tsx"}),"\n"]})]}),"\n","\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsxs)(n.li,{children:["Install ",(0,r.jsx)(n.code,{children:"framer-motion"})," package which is required by ",(0,r.jsx)(n.code,{children:"assistant-ui"}),"'s\nthread.",(0,r.jsx)(n.br,{}),"\n",(0,r.jsx)(n.code,{children:"npm install framer-motion"})]}),"\n"]}),"\n","\n",(0,r.jsxs)(t,{children:[(0,r.jsx)(n.p,{children:"$ npm install framer-motion"}),(0,r.jsx)(n.p,{children:"up to date, audited 374 packages in 696ms"}),(0,r.jsxs)(n.p,{children:["141 packages are looking for funding\nrun ",(0,r.jsx)(n.code,{children:"npm fund"})," for details"]}),(0,r.jsx)(n.p,{children:"found 0 vulnerabilities"})]}),"\n","\n",(0,r.jsxs)(n.ol,{start:"7",children:["\n",(0,r.jsxs)(n.li,{children:["Due to ",(0,r.jsx)(n.code,{children:'"verbatimModuleSyntax": true'})," configuration, you need to fix\n",(0,r.jsx)(n.code,{children:"src/components/assistant-ui/tool-fallback.tsx"})," to prevent compile error."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{1}",children:'import type { ToolCallMessagePartComponent } from "@assistant-ui/react";\nimport { CheckIcon, ChevronDownIcon, ChevronUpIcon } from "lucide-react";\n\n// ...\n'})}),"\n",(0,r.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsxs)(n.p,{children:["We use assistant-ui's\n",(0,r.jsx)(n.a,{href:"https://www.assistant-ui.com/docs/runtimes/custom/external-store",children:(0,r.jsx)(n.strong,{children:"ExternalStoreRuntime"})}),"\nfeature to ingest messages converted from states where raw messages are stored\nin Ailoy format."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Let's start from writing conversion logics from Ailoy's ",(0,r.jsx)(n.code,{children:"Message"})," and\n",(0,r.jsx)(n.code,{children:"MessageDelta"})," to assistant-ui's ",(0,r.jsx)(n.code,{children:"useExternalMessageConverter.Message"}),".",(0,r.jsx)(n.br,{}),"\n","Create ",(0,r.jsx)(n.code,{children:"src/AiloyRuntimeProvider.tsx"})," and write the code as follow:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import { useExternalMessageConverter } from "@assistant-ui/react";\nimport * as ai from "ailoy-web";\n\nfunction imageDataToBase64(arr: Uint8Array): string {\n  let binaryString = "";\n  arr.forEach((byte) => {\n    binaryString += String.fromCharCode(byte);\n  });\n  const base64String = btoa(binaryString);\n  return base64String;\n}\n\nfunction convertMessage(\n  message: ai.Message\n): useExternalMessageConverter.Message {\n  if (message.role === "user") {\n    return {\n      role: message.role,\n      content: message.contents.map((part) => {\n        if (part.type === "text") return part;\n        else if (part.type === "image") {\n          if (part.image.type === "binary") {\n            return {\n              type: "image",\n              image: `data:image/png;base64,${imageDataToBase64(\n                part.image.data\n              )}`,\n            };\n          } else {\n            return { type: "image", image: part.image.url };\n          }\n        } else if (part.type === "value")\n          return { type: "text", text: part.value!.toString() };\n        else throw Error("Unknown content type");\n      }),\n    };\n  } else if (message.role === "assistant") {\n    let contents = [];\n    if (message.thinking) {\n      contents.push({\n        type: "reasoning",\n        text: message.thinking,\n      });\n    }\n    if (message.tool_calls) {\n      for (const toolCall of message.tool_calls) {\n        if (toolCall.type !== "function")\n          throw new Error("tool call content should be a type of function");\n        contents.push({\n          type: "tool-call",\n          toolCallId: toolCall.id,\n          toolName: toolCall.function.name,\n          args: toolCall.function.arguments,\n        });\n      }\n    }\n    for (const content of message.contents) {\n      if (content.type === "text") {\n        contents.push(content);\n      }\n    }\n    return {\n      role: message.role,\n      content: contents,\n    } as useExternalMessageConverter.Message;\n  } else if (message.role === "tool") {\n    let toolResult: string;\n    if (message.contents[0].type === "text") {\n      toolResult = message.contents[0].text;\n    } else if (message.contents[0].type === "value") {\n      toolResult = JSON.stringify(message.contents[0].value);\n    } else {\n      throw new Error("Tool result should be either text or value.");\n    }\n    return {\n      role: "tool",\n      toolCallId: message.id,\n      result: toolResult,\n    } as useExternalMessageConverter.Message;\n  } else {\n    throw new Error(`Unknown message type: ${message}`);\n  }\n}\n\nfunction convertMessageDelta(\n  delta: ai.MessageDelta\n): useExternalMessageConverter.Message {\n  if (delta.role === "assistant") {\n    let contents = [];\n    if (delta.thinking !== undefined) {\n      contents.push({\n        type: "reasoning",\n        text: delta.thinking,\n      });\n    }\n    if (delta.tool_calls.length > 0) {\n      for (const toolCall of delta.tool_calls) {\n        if (toolCall.type !== "function")\n          throw new Error("tool call content should be a type of function");\n        if (toolCall.function.type === "verbatim") {\n          contents.push({ type: "text", text: toolCall.function.text });\n        } else if (toolCall.function.type === "with_string_args") {\n          contents.push({\n            type: "text",\n            text: `{"name": "${toolCall.function.name}", "arguments": ${toolCall.function.arguments}}`,\n          });\n        } else {\n          contents.push({\n            type: "text",\n            text: `{"name": "${toolCall.function.name}", "arguments": ${toolCall.function.arguments}}`,\n          });\n        }\n      }\n    }\n    for (const content of delta.contents) {\n      if (content.type === "text") {\n        contents.push(content);\n      }\n    }\n    return {\n      role: "assistant",\n      content: contents,\n    } as useExternalMessageConverter.Message;\n  } else if (delta.role === "tool") {\n    let toolResult: string;\n    if (delta.contents[0].type === "text") {\n      toolResult = delta.contents[0].text;\n    } else if (delta.contents[0].type === "value") {\n      toolResult = JSON.stringify(delta.contents[0].value);\n    } else {\n      throw new Error("Tool result should be either text or value.");\n    }\n    return {\n      role: "tool",\n      toolCallId: delta.id,\n      result: toolResult,\n    } as useExternalMessageConverter.Message;\n  } else {\n    // Consider this case as an empty assistant message\n    return {\n      role: "assistant",\n      content: [],\n    };\n  }\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsxs)(n.li,{children:["Write ",(0,r.jsx)(n.code,{children:"AiloyRuntimeProvider"})," component as follow:"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'"use client";\n\nimport { useState, useEffect, useMemo, type ReactNode } from "react";\nimport {\n  AssistantRuntimeProvider,\n  useExternalStoreRuntime,\n  useExternalMessageConverter,\n  type AppendMessage,\n} from "@assistant-ui/react";\nimport * as ai from "ailoy-web";\n\n/// Conversion logics\n\nexport function AiloyRuntimeProvider({\n  children,\n}: Readonly<{ children: ReactNode }>) {\n  const [agent, setAgent] = useState<ai.Agent | undefined>(undefined);\n  const [agentLoading, setAgentLoading] = useState<boolean>(false);\n  // This stores the complete messages\n  const [messages, setMessages] = useState<ai.Message[]>([]);\n  // This stores the ongoing accumulated message delta\n  const [ongoingMessage, setOngoingMessage] = useState<ai.MessageDelta | null>(\n    null\n  );\n  const [isAnswering, setIsAnswering] = useState<boolean>(false);\n\n  useEffect(() => {\n    (async () => {\n      // Check if WebGPU is available first\n      const { supported, reason } = await ai.isWebGPUSupported();\n      if (!supported) {\n        alert(`WebGPU is not supported: ${reason!}`);\n        return;\n      }\n\n      setAgentLoading(true);\n\n      // Initialize the agent with local LangModel\n      const agent = new ai.Agent(\n        await ai.LangModel.newLocal("Qwen/Qwen3-0.6B")\n      );\n      setAgent(agent);\n\n      setAgentLoading(false);\n    })();\n  }, []);\n\n  const onNew = async (message: AppendMessage) => {\n    if (agent === undefined) throw new Error("Agent is not initialized yet");\n\n    // Add text content\n    if (message.content[0]?.type !== "text")\n      throw new Error("Only text messages are supported");\n\n    // Append a new user message\n    const newMessage: ai.Message = {\n      role: "user",\n      contents: [{ type: "text", text: message.content[0].text }],\n    };\n    setMessages((prev) => [...prev, newMessage]);\n\n    setIsAnswering(true);\n    let accumulated: ai.MessageDelta | null = null;\n    for await (const { delta, finish_reason } of agent.runDelta([\n      ...messages,\n      newMessage,\n    ])) {\n      // Store accumulated message delta\n      accumulated =\n        accumulated === null\n          ? delta\n          : ai.accumulateMessageDelta(accumulated, delta);\n      setOngoingMessage(accumulated);\n\n      // Finish the delta and append to messages on `finish_reason` arrived\n      if (finish_reason !== undefined) {\n        let newMessage = ai.finishMessageDelta(accumulated);\n        setMessages((prevMessages) => [...prevMessages, newMessage]);\n        setOngoingMessage(null);\n        accumulated = null;\n      }\n    }\n    setIsAnswering(false);\n  };\n\n  // Converted messages derived from raw messages and message delta\n  const convertedMessages: useExternalMessageConverter.Message[] =\n    useMemo(() => {\n      let converted = messages.map(convertMessage);\n      if (ongoingMessage !== null) {\n        let convertedDelta = convertMessageDelta(ongoingMessage);\n        converted = [...converted, convertedDelta];\n      }\n      return converted;\n    }, [messages, ongoingMessage]);\n\n  // Create ExternalStoreRuntime\n  const runtime = useExternalStoreRuntime({\n    isLoading: agentLoading,\n    isDisabled: agent === undefined,\n    isRunning: isAnswering,\n    messages: useExternalMessageConverter({\n      messages: convertedMessages,\n      callback: (msg) => msg,\n      isRunning: isAnswering,\n    }),\n    onNew,\n  });\n\n  return (\n    <AssistantRuntimeProvider runtime={runtime}>\n      {children}\n    </AssistantRuntimeProvider>\n  );\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsxs)(n.li,{children:["Update ",(0,r.jsx)(n.code,{children:"src/App.tsx"})," to wrap ",(0,r.jsx)(n.code,{children:"<Thread />"})," inside ",(0,r.jsx)(n.code,{children:"<AiloyRuntimeProvider>"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import { Thread } from "@/components/assistant-ui/thread";\nimport { AiloyRuntimeProvider } from "./AiloyRuntimeProvider";\n\nfunction App() {\n  return (\n    <AiloyRuntimeProvider>\n      <Thread />\n    </AiloyRuntimeProvider>\n  );\n}\n\nexport default App;\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:["React\u2019s ",(0,r.jsx)(n.code,{children:"<StrictMode>"})," can cause components to mount twice during\ndevelopment.",(0,r.jsx)(n.br,{}),"\n","To avoid double state updates, remove ",(0,r.jsx)(n.code,{children:"<StrictMode>"})," from ",(0,r.jsx)(n.code,{children:"src/main.tsx"}),":"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// import { StrictMode } from 'react'\nimport { createRoot } from 'react-dom/client'\nimport './index.css'\nimport App from './App.tsx'\n\ncreateRoot(document.getElementById('root')!).render(\n  // <StrictMode>\n    <App />\n  // </StrictMode>,\n)\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:["Start the development server with ",(0,r.jsx)(n.code,{children:"npm run dev"}),"."]}),"\n"]}),"\n","\n",(0,r.jsxs)(t,{children:[(0,r.jsx)(n.p,{children:"$ npm run dev"}),(0,r.jsx)(n.p,{children:"VITE v7.1.1  ready in 318 ms"}),(0,r.jsxs)(n.p,{children:["\u279c  Local:   ",(0,r.jsx)(n.a,{href:"http://localhost:5173/",children:"http://localhost:5173/"}),"\n\u279c  Network: use --host to expose\n\u279c  press h + enter to show help"]})]}),"\n","\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsxs)(n.li,{children:["Visit ",(0,r.jsx)(n.a,{href:"http://localhost:5173",children:"http://localhost:5173"})," \u2014 your chat UI should be live."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(1328).A+"",width:"1058",height:"997"})}),"\n","\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsxs)(n.p,{children:["When the agent initializes for the first time, model parameters are downloaded\nfrom Ailoy\u2019s file server. These files are stored in the browser\u2019s\n",(0,r.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/File_System_API/Origin_private_file_system",children:(0,r.jsx)(n.strong,{children:"Origin Private File System(OPFS)"})}),"\nwhich is isolated per origin and managed internally by the browser."]}),(0,r.jsx)(n.p,{children:"Once initialization completes, you can start chatting with the agent."})]}),"\n","\n",(0,r.jsxs)(n.ol,{start:"6",children:["\n",(0,r.jsxs)(n.li,{children:["Try to start a conversation with the agent running ",(0,r.jsx)(n.em,{children:"on your web browser"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(6615).A+"",width:"944",height:"882"})}),"\n",(0,r.jsxs)(n.p,{children:["\ud83c\udf89 ",(0,r.jsx)(n.strong,{children:"Congratulations!"})," You now have a fully local AI agent running ",(0,r.jsx)(n.strong,{children:"entirely\nin your browser"})," with zero backend servers!"]}),"\n",(0,r.jsx)(n.h2,{id:"additional-features",children:"Additional Features"}),"\n",(0,r.jsx)(n.h3,{id:"using-api-models",children:"Using API models"}),"\n",(0,r.jsx)(n.p,{children:"You can easily switch to API models by changing the model configuration as\nbelow."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const agent = new ai.Agent(\n  // await ai.LangModel.newLocal("Qwen/Qwen3-0.6B")\n  await ai.LangModel.newStreamAPI(\n    "OpenAI",\n    "gpt-5-mini",\n    "<YOUR_OPENAI_API_KEY>"\n  )\n);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["You can use any API models listed in\n",(0,r.jsx)(n.a,{href:"/ailoy/docs/resources/available-models",children:(0,r.jsx)(n.strong,{children:"Available Models"})}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["The above code is for test purpose. ",(0,r.jsx)(n.strong,{children:"You should never hardcode your API keys in\nyour frontend codes!"})," For example, consider making an input box to get API key\nfrom users and initialize agents using the key."]})}),"\n",(0,r.jsx)(n.h3,{id:"multi-modal-inputs",children:"Multi-Modal Inputs"}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Image inputs are currently supported only on API models as described in\n",(0,r.jsx)(n.a,{href:"/ailoy/docs/tutorial/image-inputs",children:(0,r.jsx)(n.strong,{children:"Image Inputs"})}),"."]})}),"\n",(0,r.jsxs)(n.p,{children:["Follow the guide in assistant-ui's\n",(0,r.jsx)(n.a,{href:"https://www.assistant-ui.com/docs/guides/Attachments",children:(0,r.jsx)(n.strong,{children:"Attachments documentation"})}),"\nto enable file attachment functionality."]}),"\n",(0,r.jsx)(n.p,{children:"Install attachment UI component."}),"\n",(0,r.jsx)(t,{children:(0,r.jsxs)(n.p,{children:['$ npx shadcn@latest add "',(0,r.jsx)(n.a,{href:"https://r.assistant-ui.com/attachment",children:"https://r.assistant-ui.com/attachment"}),'"']})}),"\n",(0,r.jsxs)(n.p,{children:["Similar to what we did for Thread component, edit\n",(0,r.jsx)(n.code,{children:"src/components/assistant-ui/attachment.tsx"})," as below to fix compile error."]}),"\n","\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{1}",children:'import { type PropsWithChildren, useEffect, useState, type FC } from "react";\nimport { CircleXIcon, FileIcon, PaperclipIcon } from "lucide-react";\n'})}),"\n","\n",(0,r.jsxs)(n.p,{children:["Edit ",(0,r.jsx)(n.code,{children:"src/components/assistant-ui/thread.tsx"})," to add attachment components."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{1-5,15-17,29-31,44}",children:'import {\n  ComposerAttachments,\n  ComposerAddAttachment,\n  UserMessageAttachments,\n} from "./attachment";\n\n// Update Composer\nconst Composer: FC = () => {\n  return (\n    <div ...>\n      <ThreadScrollToBottom />\n      <ThreadPrimitive.Empty>\n        <ThreadWelcomeSuggestions />\n      </ThreadPrimitive.Empty>\n      <ThreadPrimitive.Empty>\n        <ComposerAttachments />\n      </ThreadPrimitive.Empty>\n      <ComposerPrimitive.Root ...>\n        // ...\n      </ComposerPrimitive.Root>\n    </div>\n  )\n}\n\n// Update ComposerAction\nconst ComposerAction: FC = () => {\n  return (\n    <div ...>\n      <ThreadPrimitive.If running={false}>\n        <ComposerAddAttachment />\n      </ThreadPrimitive.If>\n      // ...\n    </div>\n  )\n}\n\n// Update UserMessage\nconst UserMessage: FC = () => {\n  return (\n    <MessagePrivitive.Root asChild>\n      <motion.div\n        // ...\n      >\n        <UserMessageAttachments />\n        <UserActionBar />\n        // ...\n      </motion.div>\n    </MessagePrivitive.Root>\n  )\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.code,{children:"src/AiloyRuntimeProvider.tsx"}),", update ",(0,r.jsx)(n.code,{children:"onNew"})," to handle image contents."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{4-30}",children:'const onNew = async (message: AppendMessage) => {\n  if (agent === undefined) throw new Error("Agent is not initialized yet");\n\n  let userContents: ai.Part[] = [];\n\n  // Add attachments\n  if (message.attachments !== undefined) {\n    for (const attach of message.attachments) {\n      // Add image content\n      if (attach.type === "image") {\n        const ab = await attach.file!.arrayBuffer();\n        const arr = new Uint8Array(ab);\n        const imagePart = ai.imageFromBytes(arr);\n        userContents.push(imagePart);\n      }\n      // other types are skipped\n    }\n  }\n\n  // Add text content\n  if (message.content[0]?.type !== "text")\n    throw new Error("Only text messages are supported");\n  userContents.push({ type: "text", text: message.content[0].text });\n\n  // Append a new user message\n  const newMessage: ai.Message = {\n    role: "user",\n    contents: userContents,\n  };\n  setMessages((prev) => [...prev, newMessage]);\n\n  // ...\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Add ",(0,r.jsx)(n.code,{children:"adapters"})," on ",(0,r.jsx)(n.code,{children:"useExternalStoreRuntime"})," to handle image file attachments."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{1-5,9-14}",children:'import {\n  CompositeAttachmentAdapter,\n  SimpleImageAttachmentAdapter,\n  SimpleTextAttachmentAdapter,\n} from "@assistant-ui/react";\n\nconst runtime = useExternalStoreRuntime({\n  // ...\n  adapters: {\n    attachments: new CompositeAttachmentAdapter([\n      new SimpleImageAttachmentAdapter(),\n      new SimpleTextAttachmentAdapter(),\n    ]),\n  },\n});\n'})}),"\n",(0,r.jsx)(n.p,{children:"You don't need to modify the message conversion logics further, since it already\nhandles image type contents."}),"\n",(0,r.jsx)(n.p,{children:"Now you can attach images and ask about them."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(74).A+"",width:"938",height:"868"})}),"\n",(0,r.jsx)(n.h3,{id:"reasoning",children:"Reasoning"}),"\n",(0,r.jsxs)(n.p,{children:["Follow the guide in assistant-ui's\n",(0,r.jsx)(n.a,{href:"https://www.assistant-ui.com/docs/ui/Reasoning",children:(0,r.jsx)(n.strong,{children:"Reasoning documentation"})})," to\nenable reasoning UI."]}),"\n",(0,r.jsx)(n.p,{children:"Install reasoning UI component."}),"\n",(0,r.jsx)(t,{children:(0,r.jsx)(n.p,{children:"$ npx assistant-ui@latest add reasoning"})}),"\n",(0,r.jsxs)(n.p,{children:["Pass the ",(0,r.jsx)(n.code,{children:"Reasoning"})," and ",(0,r.jsx)(n.code,{children:"ReasoningGroup"})," components to the\n",(0,r.jsx)(n.code,{children:"MessagePrimitive.Parts"})," component in ",(0,r.jsx)(n.code,{children:"src/components/assistant-ui/thread.tsx"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{1,11-12}",children:'import {Reasoning, ReasoningGroup} from "./reasoning";\n\nconst AssistantMessage: FC = () => {\n  return (\n    <MessagePrimitive.Root asChild>\n      // ...\n      <div className="...">\n        <MessagePrimitive.Parts\n          components={{\n            // ...\n            Reasoning,\n            ReasoningGroup,\n          }}\n        />\n      </div>\n      // ...\n    </MessagePrimitive.Root>\n  )\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Now you can see how reasoning is visualized by adding agent config as follow:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{3-7}",children:'for await (const { delta, finish_reason } of agent.runDelta(\n  [...messages, newMessage],\n  {\n    inference: {\n      thinkEffort: "enable",\n    },\n  }\n)) {\n  // ...\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(8306).A+"",width:"818",height:"842"})}),"\n",(0,r.jsx)(n.h3,{id:"using-tools",children:"Using Tools"}),"\n",(0,r.jsxs)(n.p,{children:["You can register tools to agents with the same APIs as described in\n",(0,r.jsx)(n.a,{href:"/ailoy/docs/tutorial/using-tools",children:(0,r.jsx)(n.strong,{children:"Using Tools"})}),". Let's add a simple tool and see how the\ntool calls and results are handled."]}),"\n",(0,r.jsxs)(n.p,{children:["Define ",(0,r.jsx)(n.code,{children:"calculator-add"})," tool and register to agent as below."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const agent = ...;\n\nconst tool = ai.Tool.newFunction(\n  {\n    name: "calculator-add",\n    description: "Get two numbers and return the addition.",\n    parameters: {\n      type: "object",\n      properties: {\n        a: {\n          type: "integer",\n          description: "The first number",\n        },\n        b: {\n          type: "integer",\n          description: "The second number",\n        },\n      },\n    },\n  },\n  async (args: { a: number; b: number }) => {\n    return args.a + args.b;\n  }\n);\nagent.addTool(tool);\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Test the tool calling with the prompt that might invoke the ",(0,r.jsx)(n.code,{children:"calculator-add"}),"\ntool."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"tool calling",src:s(1575).A+"",width:"952",height:"868"})}),"\n",(0,r.jsx)(n.h3,{id:"using-mcp-tools",children:"Using MCP Tools"}),"\n",(0,r.jsxs)(n.p,{children:["You can initialize MCP clients and use their tools in agents via\n",(0,r.jsx)(n.a,{href:"https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#streamable-http",children:(0,r.jsx)(n.strong,{children:"Streamable HTTP"})}),"\ntransport. Note that\n",(0,r.jsx)(n.a,{href:"https://modelcontextprotocol.io/specification/2025-03-26/basic/transports#stdio",children:(0,r.jsx)(n.strong,{children:"stdio"})}),"\ntransport is not supported in browsers because they cannot run a stdio process."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["When connecting to MCP servers from browsers, make sure the server is configured\nto use ",(0,r.jsx)(n.strong,{children:"CORS middleware"})," with allowing your origins and exposing required\nheaders such as ",(0,r.jsx)(n.code,{children:"Mcp-Session-Id"}),". See\n",(0,r.jsx)(n.a,{href:"https://github.com/modelcontextprotocol/typescript-sdk?tab=readme-ov-file#cors-configuration-for-browser-based-clients",children:(0,r.jsx)(n.strong,{children:"the official documentation"})}),"\nfor more details."]})}),"\n",(0,r.jsx)(n.p,{children:"Let's create a simple MCP server for testing MCP tools availability."}),"\n",(0,r.jsx)(n.p,{children:"Install the following packages."}),"\n","\n",(0,r.jsx)(t,{children:(0,r.jsx)(n.p,{children:"$ npm install express cors zod @modelcontextprotocol/sdk\n$ npm install --save-dev @types/express @types/cors"})}),"\n","\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"src/mcpServer.ts"})," and write the code as below:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import { McpServer } from "@modelcontextprotocol/sdk/server/mcp.js";\nimport { StreamableHTTPServerTransport } from "@modelcontextprotocol/sdk/server/streamableHttp.js";\nimport cors from "cors";\nimport express, { type Request, type Response } from "express";\nimport * as z from "zod/v3";\n\n// Create an MCP server\nconst server = new McpServer({\n  name: "demo-server",\n  version: "1.0.0",\n});\n\n// Add an addition tool\nserver.registerTool(\n  "add",\n  {\n    title: "Addition Tool",\n    description: "Add two numbers",\n    inputSchema: { a: z.number(), b: z.number() },\n  },\n  async ({ a, b }) => ({\n    content: [{ type: "text", text: String(a + b) }],\n  })\n);\n\nconst app = express();\napp.use(express.json());\napp.use(\n  cors({\n    origin: "*",\n    exposedHeaders: "*",\n  })\n);\n\napp.post("/mcp", async (req: Request, res: Response) => {\n  try {\n    const transport = new StreamableHTTPServerTransport({\n      sessionIdGenerator: undefined,\n    });\n    res.on("close", () => {\n      transport.close();\n      server.close();\n    });\n    await server.connect(transport);\n    await transport.handleRequest(req, res, req.body);\n  } catch (error) {\n    if (!res.headersSent) {\n      res.status(500).json({\n        jsonrpc: "2.0",\n        error: {\n          code: -32603,\n          message: "Internal server error",\n        },\n        id: null,\n      });\n    }\n  }\n});\n\nconst PORT = 3000;\napp.listen(PORT, () => {\n  console.log(`MCP server listening on ${PORT}`);\n});\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["Note that we used ",(0,r.jsx)(n.code,{children:"zod/v3"})," since the current latest version of MCP sdk does not\nwork with zod v4.\n(",(0,r.jsx)(n.a,{href:"https://github.com/modelcontextprotocol/modelcontextprotocol/issues/1072",children:(0,r.jsx)(n.strong,{children:"related issue"})}),")"]})}),"\n",(0,r.jsxs)(n.p,{children:["This MCP server runs on streamable HTTP transport and has a single tool ",(0,r.jsx)(n.code,{children:"add"}),"\nwhich takes two numbers and return the addition. The server runs on\n",(0,r.jsx)(n.code,{children:"localhost:3000"})," and uses CORS middleware to allow any origins."]}),"\n",(0,r.jsxs)(n.p,{children:["Install ",(0,r.jsx)(n.code,{children:"vite-node"})," and add a script in ",(0,r.jsx)(n.code,{children:"package.json"})," to run this server using\n",(0,r.jsx)(n.code,{children:"vite-node"}),"."]}),"\n",(0,r.jsx)(t,{children:(0,r.jsx)(n.p,{children:"$ npm install --save-dev vite-node"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",metastring:"{3}",children:'  "scripts": {\n    // ...\n    "dev:mcp": "vite-node src/mcpServer.ts"\n  }\n'})}),"\n",(0,r.jsx)(n.p,{children:"Run the MCP server."}),"\n","\n",(0,r.jsxs)(t,{children:[(0,r.jsxs)(n.p,{children:["$ npm run dev",":mcp"]}),(0,r.jsxs)(n.p,{children:["> my-project@0.0.0 dev",":mcp","\n> vite-node src/mcpServer.ts"]}),(0,r.jsx)(n.p,{children:"MCP server listening on 3000"})]}),"\n","\n",(0,r.jsxs)(n.p,{children:["In ",(0,r.jsx)(n.code,{children:"src/AiloyRuntimeProvider.tsx"}),", add MCP tools after the agent has been\ninitialized."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",metastring:"{3-4}",children:'const agent = ...;\n\nconst mcpClient = await ai.MCPClient.streamableHttp("http://localhost:3000/mcp");\nagent.addTools(mcpClient.tools);\n'})}),"\n",(0,r.jsx)(n.p,{children:"Check if MCP tools work as expected."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{src:s(129).A+"",width:"944",height:"882"})}),"\n",(0,r.jsx)(n.h2,{id:"using-vector-stores",children:"Using Vector Stores"}),"\n",(0,r.jsxs)(n.p,{children:["You can interact with Vector Stores in Ailoy Web using the same APIs described\nin ",(0,r.jsx)(n.a,{href:"/ailoy/docs/tutorial/rag-using-documents",children:(0,r.jsx)(n.strong,{children:"RAG Using Documents"})}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["When combined with ",(0,r.jsx)(n.strong,{children:"local embedding models"})," and ",(0,r.jsx)(n.strong,{children:"in-memory vector stores"}),"\nsuch as ",(0,r.jsx)(n.strong,{children:"Faiss"}),", you can build a fully client-side RAG application that runs\nentirely inside the user's browser\u2014no backend servers required. This approach is\nideal for privacy-preserving, offline-capable AI assistants."]}),"\n",(0,r.jsx)(n.h3,{id:"creating-an-embeddingmodel",children:"Creating an EmbeddingModel"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import * as ai from "ailoy-web";\n\nconst em = await ai.EmbeddingModel.newLocal("BAAI/bge-m3");\n'})}),"\n",(0,r.jsx)(n.h3,{id:"creating-a-vectorstore",children:"Creating a VectorStore"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'import * as ai from "ailoy-web";\n\n// Using an in-memory Faiss vectorstore\nconst vectorstore = await ai.VectorStore.newFaiss(1024);\n\n// Using an external ChromaDB server\nconst vectorstore = await ai.VectorStore.newChroma(\n  "http://localhost:8000", // Replace with your ChromaDB endpoint\n  "my-collection",  // Your target collection name\n);\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["When using external vector stores such as ChromaDB, make sure they're configured\nto use ",(0,r.jsx)(n.strong,{children:"CORS middleware"})," to allow your origin. For ChromaDB, refer the\n",(0,r.jsx)(n.a,{href:"https://cookbook.chromadb.dev/strategies/cors/",children:(0,r.jsx)(n.strong,{children:"CORS configuration"})}),"."]})}),"\n",(0,r.jsx)(n.h3,{id:"inserting-documents",children:"Inserting Documents"}),"\n",(0,r.jsx)(n.p,{children:"Before you can retrieve documents, you must insert them into the vector store\nalong with optional metadata."}),"\n",(0,r.jsx)(n.p,{children:"Typically, you'll chunk your text into smaller pieces before insertion for\nbetter retrieval accuracy."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const items = [\n  {\n    document:\n      "BGE M3 is an embedding model supporting dense retrieval, lexical matching and multi-vector interaction.",\n    metadata: { topic: "bge-m3" },\n  },\n  {\n    document:\n      "BM25 is a bag-of-words retrieval function that ranks a set of documents based on the query terms appearing in each document",\n    metadata: { topic: "bm25" },\n  },\n];\n\nfor (const item of items) {\n  const embedding = await em.infer(item.document);\n  const result = await vectorstore.addVector({ embedding, ...item });\n  console.log(result); // Example: "1"\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"retrieving-documents",children:"Retrieving Documents"}),"\n",(0,r.jsx)(n.p,{children:"You can retrieve the most relevant documents by similarity score, which is\ncomputed using vector embeddings."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:'const queryEmbedding = await em.infer("What is BGE-M3?");\n// Retrieve the top 1 item most similar to the query\nconst retrievedItems = await vectorstore.retrieve(queryEmbedding, 1);\nconsole.log(retrievedItems);\n// Expected: returns the document related to "bge-m3"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"clearing-the-vector-store",children:"Clearing the Vector Store"}),"\n",(0,r.jsx)(n.p,{children:"If you need to reset or remove all entries from the vector store:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"await vectorstore.clear();\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);