"use strict";(self.webpackChunkailoy_docs=self.webpackChunkailoy_docs||[]).push([[3480],{7823:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"tutorial/multi-turn-conversation","title":"Multi-Turn Conversation","description":"Ailoy\'s Agent is stateless by design. It does not keep track of conversation","source":"@site/docs/tutorial/multi-turn-conversation.mdx","sourceDirName":"tutorial","slug":"/tutorial/multi-turn-conversation","permalink":"/ailoy/docs/tutorial/multi-turn-conversation","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"documentSidebar","previous":{"title":"System Message","permalink":"/ailoy/docs/tutorial/system-message"},"next":{"title":"Image Inputs","permalink":"/ailoy/docs/tutorial/image-inputs"}}');var a=s(4848),o=s(8453);const r={},i="Multi-Turn Conversation",l={},c=[{value:"Adding Context to the Conversation",id:"adding-context-to-the-conversation",level:2},{value:"A Live Multi-Turn Conversations",id:"a-live-multi-turn-conversations",level:2}];function m(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components},{TabItem:s,Tabs:t}=n;return s||h("TabItem",!0),t||h("Tabs",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"multi-turn-conversation",children:"Multi-Turn Conversation"})}),"\n",(0,a.jsxs)(n.p,{children:["Ailoy's ",(0,a.jsx)(n.code,{children:"Agent"})," is stateless by design. It does not keep track of conversation\nhistory. Each time you invoke the agent, it treats the provided messages as a\nfresh request with no internal memory of past conversations."]}),"\n",(0,a.jsxs)(n.p,{children:["If you want to run an agent with previous context, you must explicitly ",(0,a.jsx)(n.strong,{children:"include\nthe entire conversation history"})," (all prior messages) when making the call."]}),"\n",(0,a.jsx)(n.h2,{id:"adding-context-to-the-conversation",children:"Adding Context to the Conversation"}),"\n",(0,a.jsx)(n.p,{children:"Let's say that the user and the agent have exchanged some messages, as shown in\nthe following diagram."}),"\n",(0,a.jsx)(n.mermaid,{value:'sequenceDiagram\n    participant User\n    participant Agent\n\n    User->>Agent: "John\'s favorite color is blue. Please remember that."\n    Agent->>User: "Great to hear that John\'s favorite color is blue."\n    User->>Agent: "What\u2019s John\'s favorite color?"'}),"\n",(0,a.jsxs)(n.p,{children:["You would expect the agent to answer ",(0,a.jsx)(n.code,{children:"blue"}),", considering the context."]}),"\n",(0,a.jsxs)(n.p,{children:["To add context to the conversation, you need to pass ",(0,a.jsx)(n.em,{children:"both"})," the ",(0,a.jsx)(n.strong,{children:"previous\nmessages"})," and ",(0,a.jsx)(n.strong,{children:"your new user message"}),"."]}),"\n","\n",(0,a.jsxs)(t,{groupId:"code-language",children:[(0,a.jsx)(s,{value:"python",label:"Python",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",metastring:"showLineNumbers",children:'import asyncio\n\nimport ailoy as ai\n\n\nasync def main():\n    lm = await ai.LangModel.new_local("Qwen/Qwen3-0.6B")\n    agent = ai.Agent(lm)\n\n    messages = [\n        # the previous messages\n        ai.Message(role="user", contents="John\'s favorite color is blue. Please remember that."),\n        ai.Message(role="assistant", contents="Great to hear that John\'s favorite color is blue."),\n        # your new user message\n        ai.Message(role="user", contents="What\u2019s John\'s favorite color?"),\n    ]\n    async for resp in agent.run(messages):\n        if isinstance(resp.message.contents[0], ai.Part.Text):\n            print(resp.message.contents[0].text)\n\nif __name__ == "__main__":\n    asyncio.run(main())\n'})})}),(0,a.jsx)(s,{value:"javascript",label:"JavaScript",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",metastring:"showLineNumbers",children:'import * as ai from "ailoy-node";\n\nasync function main() {\n  const model = await ai.LangModel.newLocal("Qwen/Qwen3-0.6B");\n  const agent = new ai.Agent(model);\n\n  const messages = [\n    // the previous messages\n    { role: "user", contents: "John\'s favorite color is blue. Please remember that." },\n    { role: "assistant", contents: "Great to hear that John\'s favorite color is blue." },\n    // your new user message\n    { role: "user", contents: "What\u2019s John\'s favorite color?" },\n  ];\n  for await (const resp of agent.run(messages)) {\n    if (resp.message.contents?.[0]?.type === "text")\n      console.log(resp.message.contents?.[0]?.text);\n  }\n}\n\nmain().catch((err) => {\n  console.error("Error:", err);\n});\n'})})}),(0,a.jsx)(s,{value:"web",label:"JavaScript(Web)",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",metastring:"web showLineNumbers",children:'import * as ai from "ailoy-web";\n\nasync function main() {\n  const model = await ai.LangModel.newLocal("Qwen/Qwen3-0.6B");\n  const agent = new ai.Agent(model);\n\n  const messages = [\n    // the previous messages\n    { role: "user", contents: "John\'s favorite color is blue. Please remember that." },\n    { role: "assistant", contents: "Great to hear that John\'s favorite color is blue." },\n    // your new user message\n    { role: "user", contents: "What\u2019s John\'s favorite color?" },\n  ];\n  for await (const resp of agent.run(messages)) {\n    if (resp.message.contents?.[0]?.type === "text")\n      console.log(resp.message.contents?.[0]?.text);\n  }\n}\n\nmain().catch((err) => {\n  console.error("Error:", err);\n});\n'})})})]}),"\n","\n",(0,a.jsx)(n.p,{children:"By including the full history, Ailoy can generate a coherent response while\nremaining internally stateless \u2014 it never stores conversation data between runs."}),"\n",(0,a.jsx)(n.h2,{id:"a-live-multi-turn-conversations",children:"A Live Multi-Turn Conversations"}),"\n",(0,a.jsx)(n.p,{children:"You can implement a live chat for the user and the agent by collecting real-time\nmessages and passing them back to the agent."}),"\n","\n",(0,a.jsxs)(t,{groupId:"code-language",children:[(0,a.jsx)(s,{value:"python",label:"Python",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",metastring:"showLineNumbers",children:'import asyncio\n\nimport ailoy as ai\n\n\nasync def main():\n    lm = await ai.LangModel.new_local("Qwen/Qwen3-0.6B")\n    agent = ai.Agent(lm)\n\n    print("(Enter \'exit\' to end the conversation.)")\n    messages = []\n    while (user_message := input("User: ").strip()).lower() != "exit":\n        messages.append(ai.Message(role="user", contents=user_message))\n        async for resp in agent.run(messages):\n            if isinstance(resp.message.contents[0], ai.Part.Text):\n                print("Agent:", resp.message.contents[0].text)\n            messages.append(resp.message)\n    print("Agent: It was a nice conversation!")\n\n\nif __name__ == "__main__":\n    asyncio.run(main())\n'})})}),(0,a.jsx)(s,{value:"javascript",label:"JavaScript",children:(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-typescript",metastring:"showLineNumbers",children:'import * as ai from "ailoy-node";\nimport * as readline from "readline";\n\nasync function main() {\n  const model = await ai.LangModel.newLocal("Qwen/Qwen3-0.6B");\n  const agent = new ai.Agent(model);\n  const rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout,\n  });\n\n  const question = (msg: string) =>\n    new Promise<string>((res) => rl.question(msg, res));\n  let messages: ai.Messages = [];\n\n  console.log("(Enter \'exit\' to end the conversation.)");\n\n  while (true) {\n    const input = (await question("User: ")).trim();\n    if (input.toLowerCase() === "exit") break;\n\n    messages.push({ role: "user", contents: input });\n\n    for await (const resp of agent.run(messages as ai.Messages)) {\n      if (resp.message.contents?.[0]?.type === "text")\n        console.log("Agent:", resp.message.contents?.[0]?.text);\n      messages.push(resp.message);\n    }\n  }\n\n  console.log("Agent: It was a nice conversation!");\n  rl.close();\n}\n\nmain().catch((err) => {\n  console.error("Error:", err);\n});\n'})})})]}),"\n",(0,a.jsx)(n.admonition,{type:"info",children:(0,a.jsxs)(n.p,{children:["Example code for web environments is not provided here.",(0,a.jsx)(n.br,{}),"\n","To see a conversational agent that continuously interacts with the user, check out the ",(0,a.jsx)(n.strong,{children:(0,a.jsx)(n.a,{href:"webassembly-supports",children:"WebAssembly Supports"})})," page."]})}),"\n"]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(m,{...e})}):m(e)}function h(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}}}]);